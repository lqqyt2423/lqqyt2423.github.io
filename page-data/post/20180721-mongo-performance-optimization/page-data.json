{"componentChunkName":"component---src-templates-blog-post-js","path":"/post/20180721-mongo-performance-optimization/","result":{"data":{"site":{"siteMetadata":{"title":"lqqyt2423's blog"}},"markdownRemark":{"id":"5e6a1edd-b8f5-5682-8e3d-c17246f48ffc","excerpt":"组合索引相关 组合索引是顺序相关的，顺序不同的索引对于不同的查询会产生不同的效果。 组合索引支持与索引字段的前缀匹配的查询。 排序相关 support used Index Prefix             support used Index Prefix…","html":"<h2>组合索引相关</h2>\n<p>组合索引是顺序相关的，顺序不同的索引对于不同的查询会产生不同的效果。</p>\n<p>组合索引支持与索引字段的前缀匹配的查询。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.produces.createIndex({ &quot;item&quot;: 1, &quot;stock&quot;: 1 })\n\n# 下面两个 query 都会用到此索引：\ndb.products.find({ item: &#39;Banana&#39; })\ndb.products.find({ item: &#39;Banana&#39;, stock: { $gt: 5 } })</code></pre></div>\n<p>排序相关</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.data.createIndex({ a: 1, b: 1, c: 1, d: 1 })</code></pre></div>\n<table>\n<thead>\n<tr>\n<th>support</th>\n<th>used Index Prefix</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">db.data.find().sort({ a: 1 })</code></td>\n<td><code class=\"language-text\">{ a: 1 }</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">db.data.find().sort({ a: -1 })</code></td>\n<td><code class=\"language-text\">{ a: 1 }</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">db.data.find().sort({ a: 1, b: 1 })</code></td>\n<td><code class=\"language-text\">{ a: 1, b: 1 }</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">db.data.find().sort({ a: -1, b: -1 })</code></td>\n<td><code class=\"language-text\">{ a: 1, b: 1 }</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">db.data.find().sort({ a: 1, b: 1, c: 1 })</code></td>\n<td><code class=\"language-text\">{ a: 1, b: 1, c: 1 }</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">db.data.find({ a: { $gt: 4 } }).sort({ a: 1, b: 1 })</code></td>\n<td><code class=\"language-text\">{ a: 1, b: 1 }</code></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>support</th>\n<th>used Index Prefix</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">db.data.find({ a: 5 }).sort({ b: 1, c: 1 })</code></td>\n<td><code class=\"language-text\">{ a: 1, b: 1, c: 1 }</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">db.data.find({ b: 3, a: 4 }).sort({ c: 1 })</code></td>\n<td><code class=\"language-text\">{ a: 1, b: 1, c: 1 }</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">db.data.find({ a: 5, b: { $lt: 3 } }).sort({ b: 1 })</code></td>\n<td><code class=\"language-text\">{ a: 1, b: 1 }</code></td>\n</tr>\n</tbody>\n</table>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># not support\ndb.data.find({ a: { $gt: 2 } }).sort({ c: 1 })\ndb.data.find({ c: 5 }).sort({ c: 1 })</code></pre></div>\n<h2>索引相关操作</h2>\n<p>列出所有索引</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.collection.getIndexes()</code></pre></div>\n<p>删除索引</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.collection.dropIndex({ a: 1 })</code></pre></div>\n<p>删除所有索引</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.collection.dropIndexes()</code></pre></div>\n<p>查看索引的调用数据</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.collection.aggregate([{ $indexStats: {} }])</code></pre></div>\n<h2>explain() 返回 query 的详细信息</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.collection.explain().&lt;method(...)&gt;\n\nVerbosity Modes:\nqueryPlanner Mode (default)\nexecutionStats Mode eg: db.users.explain(&#39;executionStats&#39;).count({})\nallPlansExecution Mode</code></pre></div>\n<p><a href=\"https://docs.mongodb.com/manual/reference/explain-results/\">explain results</a></p>\n<h2><a href=\"https://docs.mongodb.com/manual/tutorial/manage-the-database-profiler/\">Database Profile</a></h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">db.getProfilingStatus()\ndb.setProfilingLevel(2)\ndb.setProfilingLevel(1, { slowms: 20 })\n\n# disable\ndb.setProfilingLevel(0)</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">collection: system.profile</code></pre></div>\n<p><a href=\"https://docs.mongodb.com/manual/reference/database-profiler/\">database profiler output</a></p>","frontmatter":{"title":"Mongo 性能优化相关","date":"July 20, 2018","description":""}}},"pageContext":{"slug":"/20180721-mongo-performance-optimization/","previous":{"fields":{"slug":"/20180715-python-basic-notes/","path":"/post/20180715-python-basic-notes/"},"frontmatter":{"title":"Python 基础知识点"}},"next":{"fields":{"slug":"/20181108-golang-docker-example/","path":"/post/20181108-golang-docker-example/"},"frontmatter":{"title":"Golang Docker 示例"}}}}}