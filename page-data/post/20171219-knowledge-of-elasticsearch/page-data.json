{"componentChunkName":"component---src-templates-blog-post-js","path":"/post/20171219-knowledge-of-elasticsearch/","result":{"data":{"site":{"siteMetadata":{"title":"lqqyt2423's blog"}},"markdownRemark":{"id":"6a4becc8-f220-5d25-8789-84342227b5e9","excerpt":"搜索 全文搜索 match match_phrase 多个搜索/过滤条件 排序  表示搜索相关性打分。 should 时添加最小匹配数量 限制返回数据字段 控制返回item 数量及分页 多字段索引且提升权重 function score  线性  内 相等  衰减率 提升某个搜索权重 match  表示提升此条件1…","html":"<h3>搜索</h3>\n<h4>全文搜索</h4>\n<h5>match</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search?pretty -d &#39;{\n  &quot;query&quot;: {\n    &quot;match&quot;: {\n      &quot;[field]&quot;: &quot;[keyword]&quot;\n    }\n  }\n}&#39;</code></pre></div>\n<h5>match_phrase</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search?pretty -d &#39;{\n  &quot;query&quot;: {\n    &quot;match_phrase&quot;: {\n      &quot;[field]&quot;: &quot;[keyword]&quot;\n    }\n  }\n}&#39;</code></pre></div>\n<h4>多个搜索/过滤条件</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search?pretty -d &#39;{\n  &quot;query&quot;: {\n    &quot;bool&quot;: {\n      &quot;filter&quot;: [...],\n      &quot;should&quot;: [...],\n      &quot;must&quot;: [...],\n      &quot;must_not&quot;: [...]\n    }\n  }\n}&#39;</code></pre></div>\n<h4>排序</h4>\n<p><code class=\"language-text\">_score</code> 表示搜索相关性打分。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search -d &#39;{\n  &quot;query&quot;: {...},\n  &quot;sort&quot;: [\n    { &quot;_score&quot;: &quot;desc&quot; },\n    { &quot;weight&quot;: &quot;desc&quot; },\n    { &quot;price&quot;: &quot;asc&quot; }\n  ]\n}&#39;</code></pre></div>\n<h4>should 时添加最小匹配数量</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 最小匹配1个</span>\nquery<span class=\"token punctuation\">.</span>bool<span class=\"token punctuation\">.</span>minimum_should_match <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>限制返回数据字段</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search -d &#39;{\n  &quot;query&quot;: {...},\n  &quot;_source&quot;: [&quot;title&quot;, &quot;name&quot;...]\n}&#39;</code></pre></div>\n<h4>控制返回item 数量及分页</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search -d &#39;{\n  &quot;query&quot;: {...},\n  &quot;size&quot;: 20,\n  &quot;from&quot;: 10\n}&#39;</code></pre></div>\n<h4>多字段索引且提升权重</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search?pretty -d &#39;{\n  &quot;query&quot;: {\n    &quot;multi_match&quot;: {\n      &quot;query&quot;: &quot;[keyword]&quot;,\n      &quot;fields&quot;: [ &quot;title^3&quot;, &quot;content&quot; ]\n    }\n  }\n}&#39;</code></pre></div>\n<h4>function score</h4>\n<ul>\n<li><code class=\"language-text\">exp</code> 线性</li>\n<li><code class=\"language-text\">offset</code> 内<code class=\"language-text\">_score</code> 相等</li>\n<li><code class=\"language-text\">scale</code> 衰减率</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search?pretty -d &#39;{\n  &quot;query&quot;: {\n    &quot;function_score&quot;: {\n      &quot;query&quot;: {...},\n      &quot;function&quot;: [\n        {\n          &quot;exp&quot;: {\n            &quot;createdAt&quot;: {\n              &quot;offset&quot;: &quot;90d&quot;,\n              &quot;scale&quot;: &quot;720d&quot;\n            }\n          }\n        }\n      ]\n    }\n  }\n}&#39;</code></pre></div>\n<h3>提升某个搜索权重</h3>\n<h4>match</h4>\n<p><code class=\"language-text\">boost: 10</code> 表示提升此条件10倍打分</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search -d &#39;{\n  &quot;query&quot;: {\n    &quot;bool&quot;: {\n      &quot;should&quot;: [\n        { &quot;match&quot;: { &quot;[field]&quot;: { &quot;query&quot;: &quot;[keyword1]&quot;, &quot;boost&quot;: 10 } } },\n        { &quot;match&quot;: { &quot;[field]&quot;: &quot;[keyword2]&quot; } }\n      ],\n      &quot;minimum_should_match&quot;: 1\n    }\n  }\n}&#39;</code></pre></div>\n<h4>term</h4>\n<p><code class=\"language-text\">boost: 10</code> 表示提升此条件10倍打分</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search -d &#39;{\n  &quot;query&quot;: {\n    &quot;bool&quot;: {\n      &quot;should&quot;: [\n        { &quot;term&quot;: { &quot;[field]&quot;: { &quot;value&quot;: &quot;[keyword1]&quot;, &quot;boost&quot;: 10 } } }，\n        { &quot;match&quot;: { &quot;[field]&quot;: &quot;[keyword2]&quot; } }\n      ],\n      &quot;minimum_should_match&quot;: 1\n    }\n  }\n}&#39;</code></pre></div>\n<h3>聚合</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_search -d &#39;{\n  &quot;query&quot;: {...},\n  &quot;aggs&quot;: {...}\n}&#39;</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 标签聚合</span>\n<span class=\"token keyword\">let</span> aggs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tags_count<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> terms<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> field<span class=\"token operator\">:</span> <span class=\"token string\">'tags'</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>查看index 数量</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/[type]/_count</code></pre></div>\n<h3>列出所有索引</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/_cat/indices</code></pre></div>\n<h3>删除索引</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XDELETE localhost:9200/[index]</code></pre></div>\n<h3>批量bulk 接口</h3>\n<p>请求体中，每单个请求放在每行，用换行符<code class=\"language-text\">\\n</code> 隔开</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XPOST localhost:9200/_bulk -d &#39;[body]&#39;</code></pre></div>\n<p>example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XPOST &#39;localhost:9200/_bulk?pretty&#39; -H &#39;Content-Type: application/json&#39; -d&#39;\n{ &quot;index&quot; : { &quot;_index&quot; : &quot;test&quot;, &quot;_type&quot; : &quot;type1&quot;, &quot;_id&quot; : &quot;1&quot; } }\n{ &quot;field1&quot; : &quot;value1&quot; }\n{ &quot;delete&quot; : { &quot;_index&quot; : &quot;test&quot;, &quot;_type&quot; : &quot;type1&quot;, &quot;_id&quot; : &quot;2&quot; } }\n{ &quot;create&quot; : { &quot;_index&quot; : &quot;test&quot;, &quot;_type&quot; : &quot;type1&quot;, &quot;_id&quot; : &quot;3&quot; } }\n{ &quot;field1&quot; : &quot;value3&quot; }\n{ &quot;update&quot; : {&quot;_id&quot; : &quot;1&quot;, &quot;_type&quot; : &quot;type1&quot;, &quot;_index&quot; : &quot;test&quot;} }\n{ &quot;doc&quot; : {&quot;field2&quot; : &quot;value2&quot;} }\n&#39;</code></pre></div>\n<h3>安装中文分词插件</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">https://github.com/medcl/elasticsearch-analysis-ik/</code></pre></div>\n<h3>新建索引</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XPUT localhost:9200/[index]</code></pre></div>\n<h3>创建映射时的设置</h3>\n<p>下面<code class=\"language-text\">title</code> 字段表示用<code class=\"language-text\">ik</code> 插件分词，<code class=\"language-text\">link</code> 字段表示不进行任何分词</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XPOST localhost:9200/[index]/[type]/_mapping -d &#39;{\n  &quot;properties&quot;: {\n    &quot;title&quot;: {\n      &quot;type&quot;: &quot;text&quot;,\n      &quot;analyzer&quot;: &quot;ik_max_word&quot;,\n      &quot;search_analyzer&quot;: &quot;ik_max_word&quot;\n    },\n    &quot;link&quot;: {\n      &quot;type&quot;: &quot;string&quot;,\n      &quot;index&quot;: &quot;not_analyzed&quot;\n    }\n  }\n}&#39;</code></pre></div>\n<h3>查看 index mapping</h3>\n<p><code class=\"language-text\">pretty</code> 参数表示格式化查看</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl localhost:9200/[index]/_mapping/[type]?pretty</code></pre></div>\n<h3>测试分词结果</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XGET &#39;localhost:9200/[index]/_analyze?field=[field]&amp;text=[keyword]&amp;pretty&#39;</code></pre></div>\n<h3>设置别名</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XPUT &#39;localhost:9200/[index]/_alias/[alias_name]&#39;</code></pre></div>\n<h3>查看别名</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XGET &#39;localhost:9200/[index]/_alias/*&#39;</code></pre></div>\n<h3>查看数据</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl &#39;localhost:9200/[index]/[type]/_search?pretty&#39; -H &#39;Content-Type: application/json&#39; -d &#39;{ &quot;size&quot;: 5 }&#39;</code></pre></div>","frontmatter":{"title":"elasticsearch 知识点","date":"December 18, 2017","description":""}}},"pageContext":{"slug":"/20171219-knowledge-of-elasticsearch/","previous":{"fields":{"slug":"/20171219-knowledge-of-curl/","path":"/post/20171219-knowledge-of-curl/"},"frontmatter":{"title":"curl 知识点"}},"next":{"fields":{"slug":"/20171230-way-to-check-type-in-javascript/","path":"/post/20171230-way-to-check-type-in-javascript/"},"frontmatter":{"title":"检测JavaScript 中各种类型"}}}}}